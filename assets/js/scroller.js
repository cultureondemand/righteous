function scroller(){var windowHeight;var container=d3.select('body');var dispatch=d3.dispatch("active","progress");var sections=null;var sectionPositions=[];var currentIndex=-1;var containerStart=0;var containerStartB=0;var yyy;var conheight;function scroll(els){sections=els;d3.select(window).on("scroll.scroller",position).on("resize.scroller",resize);resize();d3.timer(function(){position();return true;});}function resize(){sectionPositions=[];var startPos;sections.each(function(d,i){var top=this.getBoundingClientRect().top;var conheight=this.getBoundingClientRect().height;if(i===0){startPos=top;}sectionPositions.push((top+conheight)-startPos);});containerStart=(container.node().getBoundingClientRect().top+container.node().getBoundingClientRect().height)+window.pageYOffset;containerStartB=container.node().getBoundingClientRect().top+container.node().getBoundingClientRect().height;}function position(){var pos=window.pageYOffset+36-containerStart;var sectionIndex=d3.bisect(sectionPositions,pos);sectionIndex=Math.min(sections.size()-1,sectionIndex);if(currentIndex!==sectionIndex){dispatch.active(sectionIndex);currentIndex=sectionIndex;console.log(pos);}var prevIndex=Math.max(sectionIndex-1,0);var prevTop=sectionPositions[prevIndex];var progress=(pos-prevTop)/(sectionPositions[sectionIndex]-prevTop);dispatch.progress(currentIndex,progress);}scroll.container=function(value){if(arguments.length===0){return container;}container=value;return scroll;};d3.rebind(scroll,dispatch,"on");return scroll;}